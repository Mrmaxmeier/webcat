<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FQDN and Submission Search</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #002b36; /* Base03 */
            color: #93a1a1; /* Base1 */
        }

        /* Section 1: FQDN submission */
        .header {
            min-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #073642; /* Base02 */
            padding-top: 20px;
        }

        .logo-container img {
            width: 200px;
            height: auto;
            max-width: 100%;
        }

        .description {
            font-size: 1.2rem;
            margin-top: 1rem;
            margin-bottom: 2rem;
        }

        /* Input fields */
        .input-group, .input-group-number {
            display: inline-flex;
            align-items: center;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
        }

        input[type="text"],
        input[type="number"] {
            padding: 10px;
            font-size: 1rem;
            border: none;
            outline: none;
            background-color: #586e75; /* Base01 */
            color: #fdf6e3; /* Higher contrast for input text */
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }

        /* Remove arrows from number input */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        select {
            padding: 10px;
            font-size: 1rem;
            border: none;
            outline: none;
            background-color: #657b83; /* Base00 */
            color: #93a1a1; /* Base1 */
            border-left: 1px solid #586e75;
        }

        /* Button styles */
        .submit-btn {
            padding: 10px 20px;
            font-size: 1rem;
            background-color: #268bd2; /* Blue */
            color: white;
            border: none;
            cursor: pointer;
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .submit-btn:hover {
            background-color: #2aa198; /* Cyan */
        }

        .response-panel {
            margin-top: 1rem;
            padding: 10px;
            width: 100%; /* Make the panel full width */
            box-sizing: border-box; /* Ensure padding doesn't affect width */
            display: none;
            border-radius: 0px; /* Remove rounded corners */
            text-align: center; /* Ensure text is left-aligned */
            color: #fdf6e3; /* Ensure text color is consistent */
        }

        .response-ok {
            background-color: #2aa198; /* Cyan */
            color: white;
        }

        .response-ko {
            background-color: #cb4b16; /* Orange */
            color: white;
        }


        /* Section 2: Submission ID search */
        .search-section {
            background-color: #002b36; /* Base03 */
            padding: 2rem 0;
            text-align: center;
        }

        /* Section 3: Endpoint info and stats */
        .info-section {
            background-color: #073642; /* Base02 */
            padding: 2rem 0;
        }

        .info-section-header {
            text-align: center;
        }

        .columns {
            display: flex;
            justify-content: space-around;
            margin-top: 2rem;
        }

        .column {
            color: #93a1a1; /* Base1 */
            margin-bottom: 2rem;
            background-color: #586e75; /* Base01 */
            padding: 1rem;
            border-radius: 8px;
            color: #fdf6e3; /* Higher contrast for readability */
            width: 30%;
        }

        .column pre {
            background-color: #000000; /* Base02 */
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #839496; /* Lighter text for JSON examples */
            overflow-x: auto;
        }

        /* Footer */
        .footer {
            background-color: #002b36; /* Base03 */
            text-align: center;
            padding: 1rem;
            color: #93a1a1; /* Base1 */
        }

        .footer a {
            color: #2aa198; /* Cyan */
            text-decoration: none;
        }
    </style>
</head>
<body>

    <!-- First section: FQDN submission -->
    <div class="header">
        <div class="logo-container">
            <svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" style="shape-rendering:geometricPrecision;text-rendering:geometricPrecision;image-rendering:optimizeQuality;fill-rule:evenodd;clip-rule:evenodd" viewBox="0 0 256 256"><path style="opacity:1" fill="#fefffe" d="M123.437 16.533c29.205 -1.03 54.964 7.602 77.274 25.896 12.866 11.704 22.802 25.59 29.807 41.659 4.256 10.714 7.061 21.815 8.415 33.304q0.585 11.557 0 23.111c-1.12 9.316 -3.253 18.363 -6.4 27.141 -4.843 12.168 -11.322 23.309 -19.437 33.422a68.978 68.978 0 0 0 -3.2 3.556c-1.284 1.126 -2.489 2.331 -3.615 3.615 -2.572 2.273 -5.139 4.525 -7.704 6.756a223.407 223.407 0 0 1 -11.259 8.119c-17.797 10.628 -37.115 16.04 -57.956 16.237 -5.06 0.085 -10.097 -0.192 -15.111 -0.83q-4.942 -0.836 -9.896 -1.6 -15.519 -3.433 -29.63 -10.667 -16.235 -9.017 -28.859 -22.578a296.652 296.652 0 0 1 -7.111 -8.77 572.919 572.919 0 0 1 -7.23 -10.785Q12.676 151.13 17.719 113.185q1.965 -12.761 6.163 -24.948 8.866 -22.791 25.719 -40.237a392.059 392.059 0 0 1 6.163 -5.689q9.668 -8.11 21.096 -13.748 12.145 -5.974 25.363 -9.244a170.074 170.074 0 0 1 21.215 -2.785m0 10.43q35.63 -1.351 64.356 19.022a45.156 45.156 0 0 0 3.437 2.667q13.888 11.44 22.933 26.904 9.844 16.171 13.156 34.963c0.453 2.615 0.828 5.242 1.126 7.881 1.241 15.006 -0.497 29.604 -5.215 43.793 -2.376 6.374 -5.28 12.457 -8.711 18.252a155.615 155.615 0 0 1 -6.637 9.956 164.148 164.148 0 0 1 -5.867 6.993 344.178 344.178 0 0 0 -7.585 7.585 377.719 377.719 0 0 1 -6.044 4.919c-12.833 9.121 -27.016 15.225 -42.548 18.311a128.996 128.996 0 0 1 -20.741 1.304 66.963 66.963 0 0 0 0.711 -2.726c1.524 -4.007 3.065 -7.998 4.622 -11.97 2.42 -5.303 5.344 -10.28 8.77 -14.933 0.652 -0.751 1.324 -1.481 2.015 -2.193 2.348 -2.152 4.718 -4.247 7.111 -6.281 2.387 -1.865 4.994 -3.367 7.822 -4.504 1.052 -0.319 2.099 -0.654 3.141 -1.007 4.181 -1.081 8.35 -2.207 12.504 -3.378 3.976 -1.255 7.611 -3.111 10.904 -5.57 4.254 -3.815 7.789 -8.18 10.607 -13.096 3.865 -6.815 6.491 -14.104 7.881 -21.867a17.493 17.493 0 0 0 0.059 -5.037c-0.198 -0.479 -0.396 -0.953 -0.593 -1.422a433.067 433.067 0 0 0 -6.044 -6.993 206.341 206.341 0 0 1 -3.97 -5.215 191.17 191.17 0 0 1 -6.459 -11.022 124.207 124.207 0 0 0 -4.03 -6.163q-3.644 -4.896 -8.356 -8.83 -13.659 -10.694 -30.756 -14.756a819.081 819.081 0 0 0 -10.726 -1.541 36.741 36.741 0 0 0 -0.415 -1.659 834.37 834.37 0 0 1 -1.422 -25.719 64.356 64.356 0 0 1 -0.415 -2.43 6.519 6.519 0 0 1 -0.474 -1.422c-0.508 -0.982 -1.298 -1.614 -2.37 -1.896 -1.032 -0.089 -2.059 -0.05 -3.081 0.119 -0.474 0.287 -0.988 0.485 -1.541 0.593a65.778 65.778 0 0 0 -9.126 6.222 246.756 246.756 0 0 1 -5.452 4.563 43.022 43.022 0 0 1 -4.03 3.556A294.637 294.637 0 0 0 84.03 82.43Q74.116 95.037 67.615 109.867a145.422 145.422 0 0 0 -3.496 9.896 217.244 217.244 0 0 1 -1.422 5.689 39.111 39.111 0 0 1 -1.541 2.844 216.059 216.059 0 0 1 -10.548 13.274 3234.489 3234.489 0 0 0 -3.793 4.978c-0.787 0.905 -1.577 1.815 -2.37 2.726a978.489 978.489 0 0 0 -9.067 11.733 47.644 47.644 0 0 1 -2.193 2.37c-4.557 -13.268 -6.453 -26.937 -5.689 -41.007a137.007 137.007 0 0 0 0.474 -6.044 110.696 110.696 0 0 1 1.007 -6.696 270.815 270.815 0 0 1 3.081 -12.919 199.348 199.348 0 0 0 2.133 -6.341 146.015 146.015 0 0 1 8.711 -17.185 292.385 292.385 0 0 1 6.341 -9.126 342.874 342.874 0 0 1 5.867 -6.637q10.168 -10.392 22.874 -17.541a140.681 140.681 0 0 1 18.489 -8.178 109.867 109.867 0 0 1 12.622 -3.081 27.378 27.378 0 0 0 3.556 -0.533c3.597 -0.419 7.192 -0.794 10.785 -1.126m37.096 83.674a28.919 28.919 0 0 1 4.148 0.356 23.941 23.941 0 0 1 2.844 1.422 9.304 9.304 0 0 0 1.659 1.363 16.593 16.593 0 0 0 1.6 1.719c1.525 1.957 2.02 4.169 1.481 6.637 -0.881 3.241 -2.738 5.691 -5.57 7.348q-3.269 1.348 -6.756 0.533a27.97 27.97 0 0 1 -2.252 -0.948 20.421 20.421 0 0 1 -3.259 -3.141 22.116 22.116 0 0 1 -1.896 -4.03q-1.065 -4.174 1.422 -7.585a11.496 11.496 0 0 0 1.126 -1.481 36.267 36.267 0 0 1 2.015 -1.481c1.12 -0.436 2.266 -0.673 3.437 -0.711"/><path style="opacity:1" fill="#fefffe" d="M162.667 51.378c1.815 -0.411 3.159 0.181 4.03 1.778a28.563 28.563 0 0 0 0.533 1.422 480.119 480.119 0 0 1 0.356 28.563 1.193 1.193 0 0 0 -0.178 0.711c-0.427 -0.04 -0.821 -0.178 -1.185 -0.415a50.252 50.252 0 0 1 -2.015 -1.363 179.674 179.674 0 0 0 -10.015 -4.622 146.844 146.844 0 0 0 -9.067 -3.141 370.726 370.726 0 0 1 -8.652 -2.133c-0.171 -0.133 -0.25 -0.311 -0.237 -0.533a5.476 5.476 0 0 1 0.296 -1.067c0.625 -0.879 1.316 -1.689 2.074 -2.43a288.593 288.593 0 0 1 17.304 -13.393 258.37 258.37 0 0 1 4.444 -2.548q1.116 -0.579 2.311 -0.83"/></svg>
        </div>
        <div class="description">Enter a Fully Qualified Domain Name (FQDN) and select an action</div>
        <div class="input-group">
            <input id="fqdn-input" type="text" placeholder="Enter FQDN" required
                   pattern="^(?!\-)([a-zA-Z0-9\-]{1,63}\.)+[a-zA-Z]{2,63}$"
                   title="Please enter a valid hostname. Example: example.com">
            <select id="action-type">
                <option value="add">Add</option>
                <option value="modify">Modify</option>
                <option value="delete">Delete</option>
            </select>
            <button class="submit-btn" onsubmit="submitForm()">Submit</button>
        </div>
        <div id="response-panel" class="response-panel"></div>
    </div>

    <!-- Second section: Submission ID search -->
    <div class="search-section">
        <p>Search for a submission by ID</p>
        <div class="input-group-number">
            <input id="submission-id-input" type="number" placeholder="Enter Submission ID" required>
            <button class="submit-btn" onsubmit="searchSubmission()">Search</button>
        </div>
        <div id="search-response-panel" class="response-panel"></div>
    </div>

    <!-- Third section: Endpoint information and total submissions -->
    <div class="info-section">
        <div class="info-section-header">
            <p>Information about the endpoints and submission statistics</p>
        </div>
        <div class="columns">
            <div class="column">
                <h2>Submit</h2>
                <p><code>POST /api/v1/submissions</code></p>
                <code><pre>
{
    "fqdn": "&lt;hostname&gt;",
    "type": "ADD|MODIFY|DELETE"
}
            </pre></code>
            <h4>Response</h4>
            <code><pre>
{
    "status": "OK",
    "id": &lt;integer_id&gt;
}
                </pre></code>
            </div>
            <div class="column">
                <h2>Check</h2>
                <p><code>GET /api/v1/submission/&lt;id&gt;</code></p>
                <h4>Response</h4>
                <code><pre>
{
    "status": "OK",
    "id": 12345,
    "fqdn": "example.com",
    "type": "add",
    "status": "success"
}
                </pre></code>
            </div>
            <div class="column" id="total-submissions-column">
                <p><strong>Total Submissions</strong><br>Loading...</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Part of <a href="https://transparency.cat" tagret="_blank">webcat</a> | <a href="https://github.com/freedomofpress/webcat">Source Code</a></p>
    </div>

    <script>
        // Handle FQDN submission
        async function submitForm() {
            const fqdnInput = document.getElementById('fqdn-input');
            const fqdn = fqdnInput.value;
            const action = document.getElementById('action-type').value;
            const responsePanel = document.getElementById('response-panel');

            const data = { fqdn, type: action };

            try {
                const response = await fetch('/submissions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok && result.status === "OK") {
                    responsePanel.style.display = 'block';
                    responsePanel.className = 'response-panel response-ok';
                    responsePanel.textContent = `Submission successful! Submission ID: ${result.id}`;
                } else {
                    responsePanel.style.display = 'block';
                    responsePanel.className = 'response-panel response-ko';
                    responsePanel.textContent = `Error: ${response.status}. Message: ${result.status}`;
                }
            } catch (error) {
                responsePanel.style.display = 'block';
                responsePanel.className = 'response-panel response-ko';
                responsePanel.textContent = 'An error occurred. Please try again.';
            }
        }

        // Handle Submission ID search
        async function searchSubmission() {
            const submissionIdInput = document.getElementById('submission-id-input');
            const submissionId = submissionIdInput.value;
            const searchResponsePanel = document.getElementById('search-response-panel');

            try {
                const response = await fetch(`/submission/${submissionId}`, { method: 'GET' });
                const result = await response.json();

                if (response.ok && result.status === "OK") {
                    searchResponsePanel.style.display = 'block';
                    searchResponsePanel.className = 'response-panel response-ok';
                    searchResponsePanel.innerHTML = `
                        Submission ID: ${result.id}<br>
                        FQDN: ${result.fqdn}<br>
                        Type: ${result.type}<br>
                        Status: ${result.status}
                    `;
                } else {
                    searchResponsePanel.style.display = 'block';
                    searchResponsePanel.className = 'response-panel response-ko';
                    searchResponsePanel.textContent = `Error: ${response.status}. Submission not found.`;
                }
            } catch (error) {
                searchResponsePanel.style.display = 'block';
                searchResponsePanel.className = 'response-panel response-ko';
                searchResponsePanel.textContent = 'An error occurred. Please try again.';
            }
        }

        // Fetch total submissions
        async function fetchTotalSubmissions() {
            const totalSubmissionsColumn = document.getElementById('total-submissions-column');

            try {
                const response = await fetch('/submission', { method: 'GET' });
                const result = await response.json();

                if (response.ok && result.status === "OK") {
                    totalSubmissionsColumn.innerHTML = `<p><strong>Total Submissions:</strong><br>${result.total_submissions}</p>`;
                } else {
                    totalSubmissionsColumn.innerHTML = `<p><strong>Total Submissions:</strong><br>Error fetching data</p>`;
                }
            } catch (error) {
                totalSubmissionsColumn.innerHTML = `<p><strong>Total Submissions:</strong><br>Error fetching data</p>`;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', fetchTotalSubmissions);
    </script>
</body>
</html>